<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mail Service</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 1rem 0; }
        .container { background: #fff; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 500px; text-align: center; }
        .page { display: none; }
        .page.active { display: block; }
        h2 { color: #1c1e21; margin-bottom: 1.5rem; }
        input, select { width: calc(100% - 22px); padding: 12px 10px; margin-bottom: 1rem; border: 1px solid #dddfe2; border-radius: 6px; font-size: 16px; }
        button { background-color: #1877f2; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-size: 17px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 0.5rem; transition: background-color 0.2s; }
        button:hover { background-color: #166fe5; }
        a { color: #1877f2; text-decoration: none; margin-top: 1rem; display: inline-block; }
        .message { margin-top: 1rem; padding: 10px; border-radius: 6px; text-align: center; }
        .message.success { background-color: #d4edda; color: #155724; }
        .message.error { background-color: #f8d7da; color: #721c24; }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; text-align: left; }
        #userInfo { color: #606770; }
        #balance { font-weight: 600; color: #1c1e21; }
        .section { text-align: left; border: 1px solid #dddfe2; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; }
        .section label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #606770; }
        #purchasedEmailsContainer { max-height: 200px; overflow-y: auto; background-color: #f7f7f7; padding: 1rem; border-radius: 6px; }
        .email-item { background-color: #e9e9e9; padding: 8px; border-radius: 4px; margin-bottom: 8px; font-family: 'Courier New', Courier, monospace; word-break: break-all; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Registration & Login Pages -->
        <div id="registerPage" class="page"><h2>নতুন অ্যাকাউন্ট তৈরি করুন</h2><input type="text" id="regUsername" placeholder="ইউজারনেম"><input type="password" id="regPassword" placeholder="পাসওয়ার্ড"><button onclick="register()">নিবন্ধন করুন</button><div id="regMessage" class="message" style="display:none;"></div><a href="#" onclick="showPage('loginPage')">পুরোনো অ্যাকাউন্ট আছে? লগইন করুন</a></div>
        <div id="loginPage" class="page"><h2>লগইন করুন</h2><input type="text" id="loginUsername" placeholder="ইউজারনেম"><input type="password" id="loginPassword" placeholder="পাসওয়ার্ড"><button onclick="login()">লগইন</button><div id="loginMessage" class="message" style="display:none;"></div><a href="#" onclick="showPage('registerPage')">অ্যাকাউন্ট নেই? নতুন তৈরি করুন</a></div>

        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page">
            <div class="dashboard-header"><div id="userInfo">ব্যবহারকারী: <span id="usernameDisplay"></span><br>ব্যালেন্স: <span id="balance">৳ ০.০০</span></div><button onclick="logout()" style="width: auto; padding: 8px 15px;">লগ আউট</button></div>
            <div class="section">
                <h2>ইমেল কিনুন</h2>
                <label for="mailType">ইমেলের ধরন:</label><select id="mailType" onchange="checkStock()"></select>
                <div id="stockInfo" style="margin: 10px 0; color: #606770;">...</div>
                <label for="quantity">পরিমাণ:</label><input type="number" id="quantity" value="1" min="1">
                <button onclick="purchaseMail()">এখনই কিনুন</button>
                <div id="purchaseMessage" class="message" style="display:none;"></div>
            </div>
            <div id="emailsSection" class="section" style="display:none;"><h2>আপনার কেনা ইমেল</h2><div id="purchasedEmailsContainer"></div></div>
        </div>
    </div>
    <script>
        const API_URL = 'http://localhost:3000/api';
        function showPage(pageId) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); }
        window.onload = () => { localStorage.getItem('accessToken') ? showDashboard() : showPage('loginPage'); };
        function showMessage(elId, text, isError = false) { const el = document.getElementById(elId); el.textContent = text; el.className = isError ? 'message error' : 'message success'; el.style.display = 'block'; setTimeout(() => el.style.display = 'none', 5000); }
        async function register() { const u = document.getElementById('regUsername').value, p = document.getElementById('regPassword').value; try { const res = await fetch(`${API_URL}/register`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: u, password: p }) }); const data = await res.json(); showMessage('regMessage', data.message, !data.success); } catch (e) { showMessage('regMessage', 'An unexpected error occurred.', true); } }
        async function login() { const u = document.getElementById('loginUsername').value, p = document.getElementById('loginPassword').value; try { const res = await fetch(`${API_URL}/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: u, password: p }) }); const data = await res.json(); if (data.success) { localStorage.setItem('accessToken', data.accessToken); showDashboard(); } else { showMessage('loginMessage', data.message, true); } } catch (e) { showMessage('loginMessage', 'An unexpected error occurred.', true); } }
        function logout() { localStorage.removeItem('accessToken'); showPage('loginPage'); }
        async function showDashboard() { showPage('dashboardPage'); document.getElementById('purchaseMessage').style.display = 'none'; document.getElementById('emailsSection').style.display = 'none'; document.getElementById('purchasedEmailsContainer').innerHTML = ''; const token = localStorage.getItem('accessToken'); try { const res = await fetch(`${API_URL}/me`, { headers: { 'Authorization': `Bearer ${token}` } }); const data = await res.json(); if (data.success) { document.getElementById('usernameDisplay').textContent = data.username; document.getElementById('balance').textContent = `৳ ${data.balance}`; } else { logout(); } await populateMailOptions(); await checkStock(); } catch (e) { logout(); } }
        async function populateMailOptions() { try { const res = await fetch(`${API_URL}/prices`); const data = await res.json(); if (data.success) { const sel = document.getElementById('mailType'); sel.innerHTML = ''; for (const type in data.prices) { const opt = document.createElement('option'); opt.value = type; opt.textContent = `${type} (৳ ${data.prices[type].toFixed(2)})`; sel.appendChild(opt); } } } catch (e) { console.error("Price fetch error:", e); } }
        async function checkStock() { const type = document.getElementById('mailType').value; if (!type) return; const stockInfo = document.getElementById('stockInfo'); stockInfo.textContent = 'Loading stock...'; try { const res = await fetch(`${API_URL}/stock?mailType=${type}`); const data = await res.json(); stockInfo.textContent = data.success ? `In Stock: ${data.stock}` : 'Error checking stock.'; } catch (e) { stockInfo.textContent = 'Error checking stock.'; } }
        async function purchaseMail() { const token = localStorage.getItem('accessToken'); const mailType = document.getElementById('mailType').value; const quantity = document.getElementById('quantity').value; try { const res = await fetch(`${API_URL}/mail`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }, body: JSON.stringify({ mailType, quantity }) }); const data = await res.json(); if (data.success) { showMessage('purchaseMessage', 'ইমেল সফলভাবে কেনা হয়েছে!'); document.getElementById('balance').textContent = `৳ ${data.newBalance}`; const emailsContainer = document.getElementById('purchasedEmailsContainer'); const emailsSection = document.getElementById('emailsSection'); emailsContainer.innerHTML = ''; if (data.emails && data.emails.length > 0) { data.emails.forEach(email => { const emailDiv = document.createElement('div'); emailDiv.className = 'email-item'; emailDiv.textContent = email; emailsContainer.appendChild(emailDiv); }); emailsSection.style.display = 'block'; } await checkStock(); } else { showMessage('purchaseMessage', data.message, true); } } catch (e) { showMessage('purchaseMessage', 'An unexpected error occurred.', true); } }
    </script>
</body>
</html>

